---
title: "P8105 hmoework 3"
author: "Shunyi Zhang"
output: github_document
editor_options: 
  chunk_output_type: console
---

This is my solution for homework 3.

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
	fig.width = 6, 
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))

```

# Problem 1 


## Get data
```{r}
data("instacart")
```


## Explore data
The dimension of this data is `r dim(instacart)`. It has `r nrow(instacart)` rows and `r ncol(instacart)` columns. It contains variables `r ls(instacart)`. 

It has variable for user `user_id`. Variables for orders are `order_id`, `order_dow`, and `order_hour_of_day`. Variables for products are `product_id` and `product_name`. There are also variables about aisle and department, `aisle`, `aisle_id`, `department`, and `department_id`.


## Explore aisle
```{r}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```
There are 134 aisles. Among them, the aisle of fresh vegetables is the most items ordered from.


## Make plot
```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle,n)
  ) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```


## Make table: popular item
```{r}
instacart %>% 
  filter(
    aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")
  ) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(
    rank = min_rank(desc(n))
  ) %>% 
  filter(rank <= 3) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable()
```


## Makle table: mean hour
```{r}
instacart %>% 
	filter(
	  product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")
	) %>% 
	group_by(
	  product_name, order_dow
	) %>% 
	summarize(
	  mean_hour = mean(order_hour_of_day)
	) %>% 
	pivot_wider(
		names_from = order_dow,
		values_from = mean_hour
	) %>% 
  knitr::kable()
```



# Problem 2


## Get data
```{r}
accel_df = 
  read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    starts_with("activity"),
    names_to = "min_activity",
    values_to = "count_activity",
    names_prefix = "activity_"
  ) %>% 
  mutate(day = as.factor(day)) %>% 
  mutate(
    weekend_vs_weekday = recode(
      day, 
      Monday = "weekday", 
      Tuesday = "weekday", 
      Wednesday = "weekday", 
      Thursday = "weekday", 
      Friday = "weekday", 
      Saturday = "weekend", 
      Sunday = "weekend" 
    )
  ) %>% 
  mutate(
    day = factor(
      day, levels = c(
        "Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"
      )
    )
  ) %>% 
  relocate("day_id", "week", "day", "weekend_vs_weekday") %>% 
  arrange(day_id)
```
After steps of tidying, the clean data has a dimension of `r dim(accel_df)`. `day_id` represents the order of day for the study. `week`, `day`, and `weekend_vs_weekday` provide information about the day of study. `min_activity` and `count_activity` shows the count of activities at each minute of the day, recorded by the accelerometers.



